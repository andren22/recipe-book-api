<!DOCTYPE html>
<html lang="en">

<head>
 <title>Recipe Book Application</title>
 <style>
  table, th, td {
    text-align: center;
  }
  aside{
    float: left;
  }
  article{
    float: right;
  }
</style>
</head>

<body>

<h1>Recipe Book Application</h1>

  <table id="recipetable" >
    <tr>
      <th>Recipe name</th>
      <th>Yields</th>
    </tr>
  </table>

<div id="indexScreen">
  <p id="recipeslist"> </p>
  <p id="demo"></p>

  <button onclick="showCreationSection()">Create recipe</button>
</div>

<div id="createScreen">
  <aside>
    Name: <input type="text" name=input_ing id="input_ing"><br />
    Yields: <input type="text" name=input_ing id="input_ing"><br />
    Add Ingredient: <input type="text" name=input_ing id="input_ing">
    Amount: <input type="text" name=input_qty id="input_qty"><br />
    <button onclick="newIng()">Add ingredient</button><br />
    <p>Ingredients: </p>
    <p id="ingredient_list"></p>
  </aside>
  <article>
    New direction: <input type="text" name=input_qty id="input_qty">
    <button onclick="newIng()">Add direction</button>
    Directions:
    <p id="direction_list"></p>
  </article>

  <footer><button onclick="showIndexScreen()">Back</button></footer>
  
</div>  



  <script>
    document.getElementById("demo").innerHTML = "page load";
    showIndexScreen();
    loadRecipes();

    var ingNamesList=[];
    var ingAmountsList=[];
    var directionsList=[];

    function showCreationSection(){
      sectionDisplay("indexScreen","hide");
      sectionDisplay("createScreen","show");
    }

    function showIndexScreen(){
      sectionDisplay("indexScreen","show");
      sectionDisplay("createScreen","hide");
    }
    
    function sectionDisplay(sectionid,action) {        
        var x = document.getElementById(sectionid);
        if(action=="show") x.style.display = "block";
        if(action=="hide") x.style.display = "none";
        //if (x.style.display === "none") {          
    }


    function loadRecipes(){
      //recipeList = document.querySelector("table");

      recipeList = document.getElementById("recipeslist");
      document.getElementById("recipeslist").innerHTML = "loading";

    fetch("/json/recipes")
      .then(response => response.json())
      .then(responseList => {
        //Once we fetch the list, we iterate over it
        responseList.forEach(recipe => {
          // Create the table row
          row = document.createElement("ul")

          // Create the table data elements for the species and
          // description columns
          rname = document.createElement("li")
          rlink=document.createElement("a")
          rlink.href="/json/recipes/"+recipe.rId
          rlink.innerHTML=recipe.rname
          rdetails=document.createElement("p")
          rdetails.innerHTML=": "+recipe.servings+" servings, "+recipe.tmins+" minutes."
          

          // Add the data elements to the row
          rlink.appendChild(rdetails)
          // Finally, add the row element to the table itself
          rname.appendChild(rlink)
          row.appendChild(rname)
          recipeList.appendChild(row)
        })
      }) 
        document.getElementById("demo").innerHTML = "recipes load"; 
    }
/*
    function sendRecipe(){
      var recipe_name= document.getElementById("input_name").value;
      var recipe_yields=document.getElementById("input_yields").value;
      var recipe_tmins=document.getElementById("input_tmins").value;
      var new_recipe={rname: recipe_name,
                      servings:recipe_yields,
                      tmins:recipe_tmins,
                      ingNames:ingNamesList,
                      ingAmounts: ingAmountsList,
                      directions: directionsList,
                      };

      var url = "/json/recipes";
      var json = JSON.stringify(new_recipe);

      fetch(url,
      {
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          method: "POST",
          body: json
      })
      .then(function(res){ console.log(res) })
      .catch(function(res){ console.log(res) })
    }

    function newIng() {
      //var new_ingredient={ingredient_name:"",quantity:""};
        ing_name:document.getElementById("input_ing").value;
        ing_qty:document.getElementById("input_qty").value;
      if (new_ingredient.ing_qty=="" || new_ingredient.ing_qty==""){}
      else{
        ingredients.push(new_ingredient);
        iLen = ingredients.length;
        text = "<ul>";
        for (i = 0; i < iLen; i++) {
            text += "<li>" + ingredients[i].ing_name +": "+ingredients[i].ing_qty+ "</li>";
        }
          text += "</ul>";
          document.getElementById("input_ing").value="";
          document.getElementById("input_qty").value="";
          document.getElementById("ingredient_list").innerHTML = text;
      }   
    }
*/
  </script>
</body>
